%
% include the class file for GMP 2018
%
\documentclass[submission]{gmp2018}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%
% put the title of your paper here
%
\title{Interactive Layout Design on Folded Carton}

%
% put your submission number here
% this number will appear instead of authors and affiliations if the class option "submission" is active
%
\SubNumber{{\color{red}{XXX}}}

%
% put the author names here
% use the second argument as a reference to the list of affiliations
% no authors and affiliations will appear if the class option "submission" is active
%
\author{Shuang Shan}{1}
\author{Yiting Ma}{1}
\author{Chengcheng Tang}{2}
\author{Xuejin Chen}{1}

%
% put the affiliations of the authors here
%
\affiliation{1}{University of Science and Technology of China}
\affiliation{2}{Stanford University}

%
% the rest is as usual
%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\maketitle

\begin{abstract}
Cartons are broadly used in packaging industry and daily life. While most of the traditional packages are axis-aligned cuboids, there is a recent trend of creating paper packages and cartons with more complicated geometry. In this work, by identifying constraints that a 2D structural layout needs to follow to be folded consistently in 3D space and actively maintaining those constraints, we propose an interactive design and exploration framework for designers to explore possible paper packages designs. In the proposed computational framework, a designer could freely adjust the shape and structure of a carton, either in 2D or 3D.  
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
Cartons have been widely used in packaging industry to deliver various commodities including food items, daily necessities and electronic components. Instead of very basic packaging shapes like cubes, there exist multiple fantastic cartons to package wedding candies or take away coffee cups. These various designs increase much popularity, not to mention they're environmental friendly due to their recycling and degradability~\cite{Mullineux:2010:CSC:1739328.1739673}.

Cartons are usually designed based on experiance and trial-and-error, though recent years there are softwares developed to help designers improve efficiency and productivity, for example, KASEMAKE~\cite{KASEMAKE} can help users pick the existing structural designs and feed in required basic size and material, also users can re-import the finished artwork to show the print on the structural designs and fold it into a three-dimensinal view in seconds. There still comsumes much work and time to construct 3D model directly from 2D design layout. Moreover, it's sometimes intractable to fold an irregular box layout to final carton without instructions.

Researchers have studied papercraft problem for more than twenty years, they're primarily concerned with the following: (1) computational algorithm and mathmatic analysis for folding origami, as in~\cite{Ida:2007:MOC:1802954.1803021,Lang:1996:CAO:237218.237249,xl-idetc-14}; (2) problems on folding polygon and unfolding polyhedron~\cite{Bern:2003:UPC:636968.636970,O'Rourke:1998:FUC:646319.686376,Rourke2008Unfolding}, and some prooves to show the problem complexity of folding to polyhedron~\cite{Biedl:2005:NFP:1090462.1646553,Biedl2004When,Lubiw1996When}; (3) other specific structure folding problems like Kinetogami which comprises multi-primitive and reconfigurable units folded from a single sheet of paper~\cite{Gao2013Kinetogami} and applications to show the folding behaviour of paper~\cite{Thiel1998,Kishi:1998:OFP:786112.786279,Nimnual2007Virtual,Shimanuki2009Construction}. Although previous works sloved plenty problems in paper folding, they have not considered intelligent construction 3D models given 2D paper layouts. In this paper, we will focus on the carton folding problem and introduce shape optimization method to solve it.

In this paper, shape constrains for carton are proposed to optimize 2D design layout into the corresponding 3D realization. Moreover, an interactive design and exporation framework is developed to allow users design the pattern in 2D layout, and visualize it in a 3D view, which can improve the efficiency a lot when designing a complicated texture. The contribution of this paper includes the following:

(1) An interactive and exporation system is presented to design the 2D layout of cartons. It loads the specific type of layout and create the corresponding flat polymesh, by initialization and user interaction, the correct model of the carton is finally constructed.

(2) We propose simple shape constrains represented by a set of points to implement shape optimization. Observed from existing cartons,  constrains are summarized including edge constrain, coplane constrain and plane constrain to keep the shape of cartons. Besides, computer-aid detection like symmetry detection is brought to give users suggestions. 

\section{Related Work}\label{sec:relatedwork}
\subsection{Reconsturction from single line drawings} 
Line drawings of three-dimensional objects have long been studied, and the main problem is still in reconstruction given projection on two-dimensional planes. Some researchers treat this task as optimization problem. Marill proposed MSDA(Minimize the Standard Deviation of Angles) principle to emulate the interpretion of line drawings as 3D objects~\cite{Marill:1991:EHI:113057.113061}. This new criterion is used by many other researchers later. Leclerc et al. combined MSDA with the deviation from planarity as objective terms~\cite{Leclerc1992An}. Cao et al. added symmetry measure of the objects to get more complicated results~\cite{Cao:2005:ORS:1097114.1097658}. Some other researchers try to solve this problem from the information theoretic point of view. Marill minimized the description length of objects based on the idea that we usually pick the simplest one from infinite possibilities when we see the line drawing~\cite{Marill1992Why}. Shoji et al. implemented the principle of minimizing the entropy of angle distribution between line segments using genetic algorithm~\cite{Shoji20013}. 

Different from the input above, ours are expanded structural layout of three-dimensional objects in 2D planes, the lackness of 3D topology is main cencern in our problem.

\subsection{Paper folding problem}
Various types of paper crafts have been studied in the field of computation and mathmatics. Origami is the Japanese traditional paper art of making different kind of objects by a single sheet of paper, and has been long studied since 1970s~\cite{KANADE1980279}.

While researching on origami in the field of computational algorithm and geometric analysis, the simulation system is developed to visualize the folding behaviour of a single piece of paper. Thiel provides a virtual origami system including the user interface to model folded paper and show animations of folding process~\cite{Thiel1998}. Kishi et al. allows users create and edit the origami properties over the Web~\cite{Kishi:1998:OFP:786112.786279}. Nimnual et al. presented an application for package folding practices in a virtual space~\cite{Nimnual2007Virtual}. Although these applications can model folded paper well, they need given parameters to construct the model, and how to align constrains to structural layout by implementing shape optimization is our main cencern.

There are also some methods to solve the problem of carton folding. Song et al. modeled foldable objects as tree like multilink objects and use PRMs(probabilistic roadmap methods~\cite{Kavraki:1994:PRP:891758}) to find a sequence of motions to transform some configuration of a foldable object into another configuration~ \cite{Song:2000:MPA:892954}. Mullineux et al. provided a simulation of the carton during erection using a constraint-based approach. Both these work required the target state as a premise, while our work aim to generate the target configuration~\cite{Mullineux:2010:CSC:1739328.1739673}.

Talking about the complexity of folding to polyhedron problem, Lubiw provided an dynamic programming algorithm based on Aleksandrov's theorem to test whether a polygon can be folded into polyhedra which takes $O(n^2)$ time and space~\cite{Lubiw1996When}. O'Rourke examined three open problems on the subject of folding and unfolding~\cite{O'Rourke:1998:FUC:646319.686376}. Biedl et al. has studied in polynomial time to solve the question of when is the graph orthogonally convex polyhedra given a graph, edge length and facial angles, also shown that it's NP-hard to decide whether the graph is orthogonally polyhedra or not~\cite{Biedl2004When}. Rather than given graph, Biedl et al.  proved that if given a net along with the dihedral angle at each crease, we can know whether a net can be folded to a polyhedron in polynomial time, but it becomes NP-hard without the angles even adding constrains on orthogonal polyhedron, which results in more difficultes on more complex input~\cite{Biedl:2005:NFP:1090462.1646553}.Compared to our desired result, polyhedron is a set of polygons without overlap, nevertheless, our 3D model contains paste faces that needs to be fixed to another panel. These works above justify our problem being harder to solve causing by even intricater inputs.


\subsection{Shape optimization}
Least square fitting is the common method to enforce shape constrains, and have been used successfully for interactive tools and physical simulation~\cite{Botsch:2006:PCP:1281957.1281959,Igarashi:2005:ASM:1186822.1073323}. Bouaziz et al.  unified a large varity of geometric constrain into one optimization framework, and provided simple, robust implementation~\cite{Bouaziz:2012:SSD:2346796.2346802}. Tang et al. solved constrained equations by Newton-type method in a fast way, and provided an interactive system to model meshed constrained by equalities and inequalities~\cite{Tang:2014:FPM:2601097.2601213}. In our paper, we implement the shape optimization by the method introduced in \cite{Bouaziz:2012:SSD:2346796.2346802} for its robustness and simplicity.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Overview}\label{sec:overview}
The final goal is to provide a system which help users design a accurate box structural layout and adjust the layout by showing the three-dimensional view of the folded carton. We can expect a workflow like this: by importing the specified type of input and show its 2D structural layout at the same time, the system will give its initial 3D model and users can interact with the model by choosing the given suggestion to build the final carton model. After that, users can design the texture in 2D view and watch the 3D appearance immediately.

\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{images/overview.png}
	\caption{Given a 2D layout(a), we first create its 2D mesh(b), and by given a specific angle to each fold edge, we can construct the initial 3D model(c), the final model(d) is finally built through the optimization based on the information acquired from user interaction.}
	\label{fig:overview}
\end{figure} 

Figure~\ref{fig:overview} is our construction algorithm overview. Given a 2D layout Figure \ref{fig:overview}(a), its 2D mesh Figure~\ref{fig:overview}(b) is created, and by given a specific angle to each fold edge which will be explained later in section~\ref{sec:initialization}, the initial 3D model Figure~\ref{fig:overview}(c) is constructed, then the final model Figure~\ref{fig:overview}(d) is finally built through the optimization based on the information acquired from user interaction.

To formulate our problem, we assume that every plane is rigid which means the interior angle in each plane stays the same, but planes can be bent during folding. Furthermore, planes are connected by hinges at the boundry of the patches, and the planar layout has its front and back.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Algorithm}\label{sec:optimization}
\subsection{Definitions and Notations}
As an input to our initialization, a flat polymesh $L$ is created from a 2D design layout of a box, then we deform the input polymesh into its 3D realization $R_i$ according to the predicted angles along each of its fold edges, and through optimization, generate final model $R_f$. A polymesh consists of a set of vertices, edges and faces $M = (V,E,F)$, the number of vertices, edges and faces vary from one mesh to another. However, a pair of $(L,R_f)$ as the the 2D layout and its corresponding 3D realization share the same topology and therefore they have the same number of vertices, edges and faces. A flat mesh as a 2D layout $L$ has its $z$ component of each vertex set to be a constant zero: $X_z(\mathbf{v}) \equiv 0$ where $X = (X_x,X_y,X_z)$ is the vertex coordinate, and its normal of each face set as $(0,0,1)^T$: $\mathbf{n}(f) \equiv (0,0,1)^T$, where $f \in F$.

\subsection{Initialization}\label{sec:initialization}
In this section we explain the reason why using a specific angle to each fold edge, and constructing our initialized model. The basic idea is to interpret the folded state of a box as a series of rotation angles along each edge, where the problem of predicting folded state is turned into a problem of predicting these angles.

Observe from existing data, two common rules are summarized as our basic idea of initialization.

\noindent
\textbf{Plane perpendicularity} The adjacent planes should not be paralleled, and we encourage them to be perpendicular. The term used here is
\begin{equation}
\alpha_{pe} = \sum_{i = 1}^{n} [\sin^{-1}(\mathbf{n}_1 \cdot \mathbf{n}_2)]^{2},
\label{equ:perp}
\end{equation}
where $\hat{n}_1$ and $\hat{n}_2$ denotes all possible combinations of normals of adjacent planes, and $n$ is the number of such combinations.

\noindent
\textbf{Plane parallelism} It was observed that two planes with same shape are probably paralleled, so we encourage more planes with same shape to be paralleled. The term is
\begin{equation}
\alpha_{pa} = \sum_{i = 1}^{n} [\cos^{-1}(\mathbf{n}_1 \cdot \mathbf{n}_2)]^{2},
\label{equ:para}
\end{equation}
where $\hat{n}_1$ and $\hat{n}_2$ denotes all possible combinations of normals of disadjacent planes that have same shape,  and $n$ is the number of such combinations.

By implementing the CMA-ES(Covariance Matrix Adaptation Evolution Strategy)~\cite{CMAES} adding the above two constrains, the initialization result is shown in Figure~\ref{fig:initial}. Note that as our input variables are fold angles of edges, $\mathbf{n}_1 \cdot \mathbf{n}_2$ is represented by $cos\alpha$ where $\alpha$ is the angle between these two normal vectors. 

We can see from the five examples shown in Figure~\ref{fig:initial}, the up three examples can have ideal results and the bottom two results are even not closed at last, which actually caused by the two constrains above lead to a result that each angle of each edge is always $\pi/2$. As a consequence, some irregular boxes will present a boxy shape which will be refined later by user interaction.

As for our initialization, $\pi/2$ is finally set to each angle and this causes more than half of boxes folded correctly in our database.

\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{images/initial.jpg}
	\caption{Initialized results of five examples. Each row is an example, and the first column is the 2D design layout, the second column is the polymesh created from layout, the third column is the initialized results optimized with the two constrains.}
	\label{fig:initial}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Shape Constrain}
After initialization, there is still a need to refine the results that have not folded into pleasing results. The main idea is to prescribe the shape constrains througn deforming using a set of vertices of the polymesh. Moreover, with the extra information acquired from user interaction, we can finally construct the ideal 3D realization compared to the ground truth. As you can notice, the coordinate of vertices are chosen as our input instead of fold angles on edges, the reason is that constrains represented by vertices are more simple and intuitive than angles, and we can implement the algorithm introduced by Bouaziz et al. easily~\cite{Bouaziz:2012:SSD:2346796.2346802}.

We now introduce the constrains used in our construction method:

\noindent
\textbf{Edge Constrain} for each edge $\{e_j\}_{j=1...M}$, we have its start point $\mathbf{v}_{js}$ and end point $\mathbf{v}_{jt}$, then we have 
\begin{equation}
||\mathbf{v}_{js} - \mathbf{v}_{jt}||^2 = ||\mathbf{\hat{v}}_{js} - \mathbf{\hat{v}}_{jt}||^2,
\label{equ:edge}
\end{equation}
to ensure that the length of each edge stays the same.

\noindent
\textbf{Coplane Contrain} For each plane $\{p_k\}_{k=1 \dots P}$ and its normal $\mathbf{n}_k$, each line connected by two points $\mathbf{v}_{ka}, \mathbf{v}_{kb}$ on the plane is perpendicular to the normal.
\begin{equation}
\mathbf{n}_k \cdot (\mathbf{v}_{ka} - \mathbf{v}_{kb}) = 0.
\label{equ:coplane}
\end{equation}

\noindent
\textbf{Plane Constrain} For each plane $\{p_k\}_{k=1 \dots P}$, the length of each line connected by two non-adjacent points $\mathbf{v}_{ka}, \mathbf{v}_{kb}$ on the plane remains the same, so that the shape of each plane keeps unchanged.
\begin{equation}
||\mathbf{v}_{ka} - \mathbf{v}_{kb}||^2 = ||\hat{\mathbf{v}}_{ka} - \hat{\mathbf{v}}_{kb}||^2.
\label{equ:plane}
\end{equation}

The information acquired from user interaction will add enough constrains to solve the optimization problem, and one of the interaction is to choose the right given suggestion including points needed to be merged together. As for the point information, the constrains can be written like:

\noindent
\textbf{Point Constrain} 
\begin{equation}
\mathbf{v}_p - \mathbf{v}_q = 0,
\label{equ:point}
\end{equation}
if these two points $\mathbf{v}_p$, $\mathbf{v}_q$ need to be moved into the same place.

When the above constrains still lead to an ill posed problem, a soft constrain will be introduced:

\noindent
\textbf{Irrelevant Point Constrain} Points $\{\mathbf{v}_i\}$ which are not in the same plane with $\mathbf{v}_p$ or $\mathbf{v}_q$, should be near the orignal location, and this constrain just take a light weight $w$, which is set 0.001 in our experiment. 
\begin{equation}
\mathbf{v}_i - \mathbf{\hat{v}}_i = 0.
\label{equ:irrelevant}
\end{equation}

{\color{red}{Figure~\ref{fig:constrain} visually shows the constrains above.}}

\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{images/constrains.png}
	\caption{}
	\label{fig:constrain}
\end{figure}


\subsection{Aided Detection}
In order to asist users construct the final carton interactively, we also provide symmetry detection and merging points detection.

\noindent
\textbf{merging points detection} Consider the initialization results can represent the ideal model partly, the disadjacent vertices that have one edge with same length can be regarded as targets that need to be located in the same place if their Euclidean distance is below a certain threshold.

\noindent
\textbf{symmetry detection} On account of the simplicity of the carton shape, the vertices that have same length set of incident edges can be redarded as symmetric pair.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{User Interaction}\label{sec:interaction}
After initializing the flat mesh, we need to refine the model to final state through the shape constrain proposed and the information acquired from user interaction. The system provides a set of operations to asist users construct the optimized model, such as selecting points that need to be merged together. Moreover, the system can automatically detect the points that need to be located in one place and provide suggestions to allow users click the right option.

{\color{red}{Figure~\ref{fig:interface}} shows the interaction we mainly use in our system.}

\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{images/ui.png}
	\caption{}
	\label{fig:interface}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Results and Discussion}\label{sec:result}
{\color{red}{show every step of results and analysis, show Figure~\ref{fig:result}, limitation, more results Figure~\ref{fig:more}}}


\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{images/result.png}
	\caption{}
	\label{fig:result}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{images/more.png}
	\caption{}
	\label{fig:more}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conclusion and Future Work}\label{sec:conclusion}
In this paper, we present an interactive modeling system to construct 3D carton realization from 2D expanded structural layout. Simple shape constrains of cartons are also provided to implement optimization on the initial 3D models, which can asist users generate the ideal model efficiently and productively. The direction of future work is adding more operations to our system, includes automatically refining the 2D layouts by 3D models, adding the paste face through stablity detection or design the surface pattern of a carton either in 2D or 3D. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\begin{theorem}\label{theorem:pi}
%Aliquam nec sapien sit amet diam molestie tristique vitae sit amet libero,
%\begin{equation}\label{eq:pi}
%\pi = \sqrt{12}\sum^\infty_{k=0} \frac{(-3)^{-k}}{2k+1}.
%\end{equation}
%\end{theorem}

%\begin{proof}
%Curabitur metus lorem, rhoncus nec ullamcorper quis, varius eget neque. Phasellus et turpis quis massa porta tincidunt. Donec fringilla luctus libero, at adipiscing justo ullamcorper non. Mauris magna ipsum, semper eget hendrerit nec, ornare sit amet neque. Nullam elementum arcu eget tellus porta mattis.
%\end{proof}

%\noindent
%Morbi ut lorem lectus. Etiam quis dolor justo, according to~\eqref{eq:pi}. Duis suscipit laoreet sollicitudin. Phasellus lacinia adipiscing tortor at posuere. Integer eget neque ac lacus vestibulum sollicitudin. Mauris vitae lacus dui. Aenean ultrices iaculis faucibus. Suspendisse congue, lectus in vulputate convallis, magna eros gravida mi, a molestie metus urna a nibh. Suspendisse adipiscing gravida ullamcorper.
%


%\begin{corollary}
%Etiam quis mauris orci. Nam blandit elementum diam a molestie. Suspendisse ultricies auctor urna, quis sagittis metus semper vel. Cras vel nisi felis.
%\end{corollary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{abbrv}
\bibliography{ref}

\end{document}
